<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>å®è´Poo Pooæ¯æ—¥ç­¾åˆ°å¥–åŠ±ç³»ç»Ÿ</title>
  <style>
    /* åŸºæœ¬é¡µé¢æ ·å¼ */
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      margin: 20px;
      background-color: #f9f9f9;
    }
    h1 {
      color: #333;
    }
    /* åŠ è½½æ¡åŒºåŸŸ */
    #loadingBarContainer {
      width: 350px;
      height: 30px;
      background-color: #ddd;
      border-radius: 15px;
      margin: 20px auto;
      position: relative;
      overflow: hidden;
    }
    #loadingBar {
      width: 100%;
      height: 100%;
      background-color: #d4fcd4; /* æµ…ç»¿è‰²èƒŒæ™¯ */
      position: absolute;
      top: 0;
      left: 0;
    }
    #loadingProgress {
      height: 100%;
      background-color: #76c776; /* æ·±ç»¿è‰²è¿›åº¦å¡«å…… */
      width: 0%;
    }
    /* å¥–åŠ±å›¾æ ‡æ ·å¼ */
    .reward-milestone {
      position: absolute;
      top: 0;
      width: 30px;
      height: 30px;
      line-height: 30px;
      font-size: 18px;
      cursor: pointer;
      transform: translateX(-50%) scale(1);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    /* è¾¾æˆå¥–åŠ±ï¼šå˜å¤§ä¸”å‘å…‰ */
    .reward-active {
      color: #f39c12;
      transform: translateX(-50%) scale(1.3);
      box-shadow: 0 0 10px 2px rgba(243,156,18,0.8);
    }
    /* æœªè¾¾æˆå¥–åŠ± */
    .reward-inactive {
      color: #aaa;
      transform: translateX(-50%) scale(1);
    }
    /* å¥–åŠ±ä¿¡æ¯å¼¹çª— */
    #rewardInfo {
      display: none;
      position: fixed;
      top: 40%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: #fff;
      border: 1px solid #ccc;
      padding: 20px;
      border-radius: 10px;
      z-index: 1000;
    }
    /* æ—¥å†åŒºåŸŸ */
    .calendar {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 5px;
      max-width: 350px;
      margin: 20px auto;
    }
    .day {
      border: 1px solid #ccc;
      border-radius: 4px;
      padding: 5px;
      min-height: 60px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      position: relative;
      background-color: #fff;
    }
    /* å·²ç­¾åˆ°æ—¥æœŸ */
    .signed-in {
      background-color: #a8e6cf;
    }
    .day-number {
      font-size: 18px;
      font-weight: bold;
    }
    /* æ—¥å†ä¸­æ¯è¡Œæœ«å°¾çš„å°å¥–åŠ±å›¾æ ‡ */
    .reward-icon {
      font-size: 20px;
      margin-top: 5px;
    }
    /* ç­¾åˆ°æŒ‰é’® */
    #signinBtn {
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
      margin-top: 20px;
    }
    #signinBtn:disabled {
      background-color: #ccc;
      cursor: not-allowed;
    }
  </style>
</head>
<body>
  <h1>æ¯æ—¥ç­¾åˆ°å¥–åŠ±</h1>

  <!-- åŠ è½½æ¡åŒºåŸŸ -->
  <div id="loadingBarContainer">
    <div id="loadingBar">
      <div id="loadingProgress"></div>
      <!-- å¥–åŠ±å›¾æ ‡å°†åœ¨ä¸‹é¢é€šè¿‡ JavaScript åŠ¨æ€æ·»åŠ  -->
    </div>
  </div>

  <!-- å¥–åŠ±ä¿¡æ¯å¼¹çª— -->
  <div id="rewardInfo"></div>

  <!-- æ—¥å†åŒºåŸŸ -->
  <div class="calendar" id="calendar">
    <!-- æ—¥å†å•å…ƒæ ¼ç”± JS åŠ¨æ€ç”Ÿæˆ -->
  </div>

  <button id="signinBtn">ä»Šæ—¥ç­¾åˆ°</button>

  <script>
    (function() {
      // è·å–ä»Šå¤©çš„æ—¥æœŸï¼ˆæ ¼å¼ YYYY-MM-DDï¼‰
      const today = new Date();
      const yyyy = today.getFullYear();
      const mm = String(today.getMonth() + 1).padStart(2, '0');
      const dd = String(today.getDate()).padStart(2, '0');
      const todayStr = `${yyyy}-${mm}-${dd}`;
      // æ„é€ ä¸€ä¸ªä»Šå¤©æ—¥æœŸå¯¹è±¡ï¼ˆæ—¶åˆ†ç§’å½’é›¶ï¼Œä»…æ¯”è¾ƒæ—¥æœŸï¼‰
      const todayDate = new Date(yyyy, today.getMonth(), today.getDate());

      // è·å–æœ¬æœˆæ€»å¤©æ•°
      const daysInMonth = new Date(yyyy, today.getMonth() + 1, 0).getDate();

      // ä» localStorage è·å–å·²ç­¾åˆ°æ—¥æœŸæ•°ç»„
      let signedInDates = JSON.parse(localStorage.getItem('signedInDates')) || [];
      // è®¡ç®—æœ¬æœˆç´¯è®¡ç­¾åˆ°å¤©æ•°ï¼ˆåªè€ƒè™‘å½“å‰å¹´ä»½å’Œæœˆä»½ï¼‰
      let signInCount = signedInDates.filter(dateStr => {
        const [y, m, d] = dateStr.split('-');
        return parseInt(y) === yyyy && parseInt(m) === (today.getMonth() + 1);
      }).length;

      // æ›´æ–°åŠ è½½æ¡è¿›åº¦ï¼ˆç™¾åˆ†æ¯”å¡«å……ï¼‰
      const progressPercent = (signInCount / daysInMonth) * 100;
      document.getElementById('loadingProgress').style.width = progressPercent + '%';

      // å®šä¹‰å¥–åŠ±é‡Œç¨‹ç¢‘
      const milestones = [7, 14, 21, 28];

      // åŠ¨æ€æ·»åŠ å¥–åŠ±å›¾æ ‡åˆ°åŠ è½½æ¡ä¸­
      const loadingBar = document.getElementById('loadingBar');
      // å…ˆç§»é™¤å·²æœ‰å›¾æ ‡ï¼ˆè‹¥å­˜åœ¨ï¼‰
      document.querySelectorAll('.reward-milestone').forEach(icon => icon.remove());

      milestones.forEach(milestone => {
        // è®¡ç®—å›¾æ ‡åœ¨åŠ è½½æ¡ä¸­çš„ä½ç½®ï¼ˆæŒ‰ç™¾åˆ†æ¯”ï¼‰
        let leftPercent = (milestone / daysInMonth) * 100;
        const rewardIcon = document.createElement('div');
        rewardIcon.classList.add('reward-milestone');
        rewardIcon.setAttribute('data-milestone', milestone);
        // æ ¹æ®æ˜¯å¦è¾¾åˆ°é‡Œç¨‹ç¢‘è®¾ç½®æ ·å¼
        if (signInCount >= milestone) {
          rewardIcon.classList.add('reward-active');
        } else {
          rewardIcon.classList.add('reward-inactive');
        }
        rewardIcon.textContent = "ğŸ";
        rewardIcon.style.left = leftPercent + '%';
        // ç‚¹å‡»å¥–åŠ±å›¾æ ‡æ˜¾ç¤ºå¥–åŠ±è¯¦æƒ…
        rewardIcon.addEventListener('click', function(event) {
          event.stopPropagation();
          showRewardInfo(milestone);
        });
        loadingBar.appendChild(rewardIcon);
      });

      // å‡½æ•°ï¼šæ˜¾ç¤ºå¥–åŠ±è¯¦æƒ…
      function showRewardInfo(milestone) {
        const rewardInfoDiv = document.getElementById('rewardInfo');
        let content = "";
        switch(milestone) {
          case 7:
            content = "å¥–åŠ±ï¼š7å¤©ç­¾åˆ° - å°å¥–å“ï¼šç‘å¹¸å’–å•¡ä¸€æ¯ï¼";
            break;
          case 14:
            content = "å¥–åŠ±ï¼š14å¤©ç­¾åˆ° - å°å¥–å“ï¼šéœ¸ç‹èŒ¶å§¬ä¸€æ¯ï¼";
            break;
          case 21:
            content = "å¥–åŠ±ï¼š21å¤©ç­¾åˆ° - ä¸­ç­‰å¥–å“ï¼šéº¦å½“åŠ³æ—©é¤ä¸€ä»½ï¼";
            break;
          case 28:
            content = "å¥–åŠ±ï¼š28å¤©ç­¾åˆ° - è¶…çº§å¤§å¥–å“ï¼šè¶…çº§ç¢—å¤–å–ä¸€ä»½ï¼";
            break;
          default:
            content = "å¥–åŠ±ä¿¡æ¯";
        }
        rewardInfoDiv.textContent = content;
        rewardInfoDiv.style.display = 'block';
      }

      // ç‚¹å‡»é¡µé¢å…¶ä»–åœ°æ–¹éšè—å¥–åŠ±ä¿¡æ¯
      document.addEventListener('click', function() {
        document.getElementById('rewardInfo').style.display = 'none';
      });

      // ç”Ÿæˆæ—¥å†åŒºåŸŸ
      const calendarEl = document.getElementById('calendar');
      const signInBtn = document.getElementById('signinBtn');

      for (let i = 1; i <= daysInMonth; i++) {
        const dayEl = document.createElement('div');
        dayEl.classList.add('day');

        // åˆ›å»ºæ˜¾ç¤ºæ—¥æœŸæ•°å­—
        const dayNumEl = document.createElement('div');
        dayNumEl.classList.add('day-number');
        dayNumEl.textContent = i;
        dayEl.appendChild(dayNumEl);

        // å¦‚æœæœ¬è¡Œæœ€åä¸€æ ¼ï¼Œæ·»åŠ å°å¥–åŠ±å›¾æ ‡ï¼ˆä»…ä½œä¸ºè£…é¥°ï¼‰
        if ((i - 1) % 7 === 6) {
          const calRewardEl = document.createElement('div');
          calRewardEl.classList.add('reward-icon');
          calRewardEl.textContent = "ğŸ†";
          dayEl.appendChild(calRewardEl);
        }
        else{
          const calRewardEl = document.createElement('div');
          calRewardEl.classList.add('reward-icon');
          calRewardEl.textContent = "ğŸ’©";
          dayEl.appendChild(calRewardEl);
        }

        // ç”Ÿæˆå½“å‰å•å…ƒæ ¼å¯¹åº”çš„æ—¥æœŸå­—ç¬¦ä¸²
        const dayStr = `${yyyy}-${mm}-${String(i).padStart(2, '0')}`;
        const cellDate = new Date(yyyy, today.getMonth(), i);

        // å¦‚æœè¯¥æ—¥æœŸå·²ç­¾åˆ°ï¼Œåˆ™æ·»åŠ å·²ç­¾åˆ°æ ·å¼
        if (signedInDates.includes(dayStr)) {
          dayEl.classList.add('signed-in');
        } else {
          // å¦‚æœæ—¥æœŸåœ¨ä»Šå¤©ä¹‹å‰ä¸”æœªç­¾åˆ°ï¼ŒèƒŒæ™¯è®¾ä¸ºç°è‰²
          if (cellDate < todayDate) {
            dayEl.style.backgroundColor = "#ccc";
          }
        }
        calendarEl.appendChild(dayEl);
      }

      // å¦‚æœä»Šå¤©å·²ç­¾åˆ°ï¼Œåˆ™ç¦ç”¨ç­¾åˆ°æŒ‰é’®
      if (signedInDates.includes(todayStr)) {
        signInBtn.disabled = true;
        signInBtn.textContent = "ä»Šæ—¥å·²ç­¾åˆ°";
      }

      // ç­¾åˆ°æŒ‰é’®ç‚¹å‡»äº‹ä»¶
      signInBtn.addEventListener('click', function() {
        if (!signedInDates.includes(todayStr)) {
          signedInDates.push(todayStr);
          localStorage.setItem('signedInDates', JSON.stringify(signedInDates));

          // æ›´æ–°æ—¥å†ä¸­ä»Šå¤©å¯¹åº”å•å…ƒæ ¼æ ·å¼
          const dayCells = document.getElementsByClassName('day');
          for (let cell of dayCells) {
            const numberEl = cell.querySelector('.day-number');
            if (numberEl && numberEl.textContent === String(today.getDate())) {
              cell.classList.add('signed-in');
              cell.style.backgroundColor = "";
              break;
            }
          }

          // æ›´æ–°æœ¬æœˆç´¯è®¡ç­¾åˆ°å¤©æ•°åŠåŠ è½½æ¡è¿›åº¦
          signInCount = signedInDates.filter(dateStr => {
            const [y, m, d] = dateStr.split('-');
            return parseInt(y) === yyyy && parseInt(m) === (today.getMonth() + 1);
          }).length;
          const newProgressPercent = (signInCount / daysInMonth) * 100;
          document.getElementById('loadingProgress').style.width = newProgressPercent + '%';

          // æ›´æ–°å¥–åŠ±å›¾æ ‡çŠ¶æ€
          document.querySelectorAll('.reward-milestone').forEach(icon => {
            const milestone = parseInt(icon.getAttribute('data-milestone'));
            if (signInCount >= milestone) {
              icon.classList.remove('reward-inactive');
              icon.classList.add('reward-active');
            }
          });

          // è®¡ç®—è·ç¦»ä¸‹ä¸€ä¸ªå¥–åŠ±æ‰€éœ€çš„å¤©æ•°
          let nextRewardMessage = "";
          if (signInCount < 7) {
            nextRewardMessage = "ç¦»ä¸‹ä¸€ä¸ªå¥–åŠ±è¿˜æœ‰ " + (7 - signInCount) + " å¤©";
          } else if (signInCount < 14) {
            nextRewardMessage = "ç¦»ä¸‹ä¸€ä¸ªå¥–åŠ±è¿˜æœ‰ " + (14 - signInCount) + " å¤©";
          } else if (signInCount < 21) {
            nextRewardMessage = "ç¦»ä¸‹ä¸€ä¸ªå¥–åŠ±è¿˜æœ‰ " + (21 - signInCount) + " å¤©";
          } else if (signInCount < 28) {
            nextRewardMessage = "ç¦»ä¸‹ä¸€ä¸ªå¥–åŠ±è¿˜æœ‰ " + (28 - signInCount) + " å¤©";
          } else {
            // å¦‚æœæœ¬æœˆç­¾åˆ°å·²æ»¡28å¤©ï¼Œåˆ™è®¡ç®—ä»ä»Šå¤©åˆ°æœ¬æœˆç»“æŸåŠ ä¸Šä¸‹æœˆ7æ—¥ä¹‹é—´çš„å¤©æ•°
            let daysLeft = (daysInMonth - today.getDate()) + 7;
            nextRewardMessage = "ç¦»ä¸‹ä¸€ä¸ªå¥–åŠ±è¿˜æœ‰ " + daysLeft + " å¤©";
          }

          // æ˜¾ç¤ºæç¤ºä¿¡æ¯
          alert("ç­¾åˆ°æˆåŠŸï¼" + nextRewardMessage);

          signInBtn.disabled = true;
          signInBtn.textContent = "ä»Šæ—¥å·²ç­¾åˆ°";
        } else {
          alert("æ‚¨ä»Šå¤©å·²ç»ç­¾åˆ°è¿‡äº†ï¼");
        }
      });
    })();
  </script>
</body>
</html>
